<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Badge Room</title>

  <!-- Pangolin Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">

  <!-- ç²’å­ç‰¹æ•ˆ -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- å…¨å±€æ ·å¼ -->
  <link rel="stylesheet" href="style.css" />

  <!-- æœ¬é¡µè¿½åŠ å¾®è°ƒ -->
  <style>
    #particles-js{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none;}

    .tab-content{display:none;}
    .tab-content.active{display:block;}

    .backend-nav{display:flex;gap:1rem;margin-bottom:1rem;}
    .backend-nav button{background:#8b6d0c;color:#fff;border:none;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;transition:.2s;}
    .backend-nav button:hover{background:#b38b14;}
    .backend-nav button.active{box-shadow:0 0 0 2px #f7e3b2 inset;}

    .home-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;}
    @media(max-width:600px){.home-grid{grid-template-columns:1fr;}}

    table{width:100%;border-collapse:collapse;font-size:0.95rem;}
    th,td{border:1px solid #e0c990;padding:0.45rem 0.6rem;text-align:center;}
    th{background:#f7e3b2;color:#8b6d0c;}

    .progress-wrap{margin-top:0.5rem;background:#f0e6d0;border-radius:6px;height:12px;overflow:hidden;}
    .progress-inner{height:100%;background:#b38b14;width:0%;transition:width .4s;}

    /* Badge Library */
    .badge-gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1rem;}
    .badge-item{text-align:center;border:1px solid #d6c28c;border-radius:8px;padding:0.5rem;cursor:pointer;transition:.2s;}
    .badge-item img{width:64px;height:64px;object-fit:contain;margin-bottom:0.3rem;}
    .badge-item:hover{transform:translateY(-4px);box-shadow:0 4px 10px rgba(0,0,0,.15);}
    .badge-item.collected{background:rgba(255,223,120,.25);border-color:#f1c40f;box-shadow:0 0 8px 2px rgba(241,196,15,.6);}
    .badge-en{font-weight:600;}
    .badge-zh{font-size:0.85rem;color:#8b6d0c;}

    .frag-log{max-height:180px;overflow-y:auto;}
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <!-- ä¾§è¾¹æ  -->
  <aside class="sidebar">
    <div class="title">Wizard Navigation</div>
    <ul class="nav-links">
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="#" class="active">Badge Room</a></li>
      <li><a href="todo.html">To Do List</a></li>
      <li><a href="wish.html">Wish & Mood</a></li>
      <li><a href="destiny.html">Destiny Room</a></li>
      <li><a href="owltower.html">Owl Tower</a></li>
    </ul>
  </aside>

  <!-- ä¸»ä½“ -->
  <main class="main-content">
    <div class="header-row"><h1 class="header-title">Badge Room</h1></div>

    <!-- BoomBoom Panel -->
    <div class="boom-panel">
      <div class="boom-avatar"><img src="assets/images/owl-star.png" alt="BoomBoom Owl"></div>
      <div class="boom-text">
        <h2>Welcome to Badge Room!</h2>
        <p id="todayInfo" style="font-size:1rem;margin-bottom:0.5rem;"></p>
        <div class="typed-line" id="boomBoomLine"></div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="backend-nav">
      <button id="btnHome"        class="active">Home</button>
      <button id="btnLibrary">Badge&nbsp;Library</button>
      <button id="btnFragment">Fragment</button>
      <button id="btnAchievement">Achievement&nbsp;Wall</button>
    </div>

    <!-- â‘  HOME -->
    <section id="tabHome" class="tab-content active">
      <div class="home-grid">
        <!-- å¾½ç« ç»Ÿè®¡ -->
        <div class="card">
          <h2>ğŸ“Š Badge Overview</h2>
          <p>Total badges: <strong id="statTotal">0</strong></p>
          <p>Types collected: <strong id="statTypes">0</strong> / 20</p>
          <div class="progress-wrap"><div id="badgeProgress" class="progress-inner"></div></div>
          <p style="margin-top:0.4rem;">Rank: <strong id="statRank">Apprentice</strong></p>
        </div>

        <!-- å¾½ç« ç™»è®° -->
        <div class="card">
          <h2>âœï¸ Badge Log</h2>
          <form id="badgeForm" style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.8rem;">
            <input type="date"   id="bDate"   required>
            <input type="text"   id="bName"   placeholder="Name"   required>
            <input type="text"   id="bReason" placeholder="Reason" required>
            <input type="number" id="bQty"    placeholder="Qty"   min="1" required style="width:70px;">
            <input type="number" id="bTotal"  placeholder="Total" min="0" required style="width:85px;">
            <button type="submit">Log</button>
          </form>
          <button id="exportCsvBtn" style="margin-bottom:0.5rem;">Export CSV</button>
          <table id="badgeTable"><thead><tr><th>Date</th><th>Name</th><th>Reason</th><th>Qty</th><th>Total</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- æé†’ -->
        <div class="card">
          <h2>ğŸ”” Almost There!</h2>
          <div style="display:flex;gap:0.5rem;"><img src="assets/images/head.png" style="width:36px;height:36px;">
            <ul id="reminderList" style="list-style:inside;margin:0;padding-left:0.2rem;"></ul>
          </div>
        </div>

        <!-- æœ€è¿‘è®°å½• -->
        <div class="card">
          <h2>ğŸ•‘ Recent Log</h2>
          <table id="recentTable"><thead><tr><th>Date</th><th>Name</th><th>Qty</th></tr></thead><tbody></tbody></table>
        </div>
      </div>
    </section>

    <!-- â‘¡ Badge Library -->
    <section id="tabLibrary" class="tab-content">
      <div class="card">
        <h2>ğŸ“š Badge Library</h2>
        <div id="badgeGrid" class="badge-gallery"></div>
        <div id="badgeDetail" class="card" style="display:none;margin-top:1rem;"></div>
      </div>
    </section>

    <!-- â‘¢ Fragment -->
    <section id="tabFragment" class="tab-content">
      <div class="card">
        <h2>âœ¨ Fragment Tracker</h2>
        <p>Fragments: <strong id="fragmentCount">0</strong></p>
        <div class="progress-wrap" style="height:16px;"><div id="fragmentBar" class="progress-inner"></div></div>

        <h3 style="margin-top:1rem;">Log Fragment Change</h3>
        <form id="fragForm" style="display:flex;gap:0.4rem;flex-wrap:wrap;margin-bottom:0.6rem;">
          <input type="date" id="fDate" required>
          <select id="fType"><option value="add">Add</option><option value="use">Use</option></select>
          <input type="number" id="fQty" placeholder="Qty" min="1" required style="width:70px;">
          <input type="text"  id="fReason" placeholder="Reason" required>
          <button type="submit">Log</button>
        </form>
        <div style="display:flex;gap:0.6rem;margin-bottom:0.6rem;">
          <button id="fragExportBtn">Export CSV</button>
          <button id="fragRedeemBtn">Redeem 10 â†  Badge</button>
        </div>
        <div class="frag-log"><table id="fragTable"><thead><tr><th>Date</th><th>Î”</th><th>Qty</th><th>Total</th><th>Reason</th></tr></thead><tbody></tbody></table></div>
      </div>
    </section>

    <!-- â‘£ Achievement Wall -->
    <section id="tabAchievement" class="tab-content">
      <div class="card">
        <h2>ğŸ† Achievement Wall</h2>
        <ul id="wallList" style="list-style:inside;"></ul>
        <p style="margin-top:1rem;"><a href="shop.html">ğŸ›’ Open Badge Shop (Coming Soon)</a></p>
      </div>
    </section>
  </main>

  <!-- å¾½ç« æ•°æ® -->
  <script src="js/badges.js"></script>

  <!-- ä¸»é€»è¾‘ -->
  <script>
    /* ===== æ—¥æœŸ & æ‰“å­—æ•ˆæœ ===== */
    document.getElementById('todayInfo').textContent=new Date().toDateString();
    const boomLines=[ "âœ¨ A new badge today keeps the dullness away!","ğŸŒŸ Every shard you collect tells a tale of effort!",
      "ğŸª„ Hooray! Another magical moment to log your victory!","ğŸ“œ Badges aren't just awardsâ€”they're wizard legacy!",
      "ğŸ© Polish your wandâ€”achievements await!","ğŸ¦‰ BoomBoom believes in every sparkle you make!","ğŸ–ï¸ One step today is a golden badge tomorrow!",
      "ğŸ’« Log a badge, write Hogwarts history!","ğŸª™ More badges, brighter wizard wall!","ğŸ”¥ Don't stopâ€”BoomBoom watches with pride!" ];
    const boomTarget=document.getElementById('boomBoomLine');
    (function type(idx=0,msg=boomLines[Math.floor(Math.random()*boomLines.length)]){if(idx<msg.length){boomTarget.textContent+=msg[idx];setTimeout(()=>type(idx+1,msg),40);}})();

    /* ===== Tab åˆ‡æ¢ ===== */
    const tabs={btnHome:'tabHome',btnLibrary:'tabLibrary',btnFragment:'tabFragment',btnAchievement:'tabAchievement'};
    Object.keys(tabs).forEach(btn=>{
      document.getElementById(btn).addEventListener('click',e=>{
        document.querySelectorAll('.backend-nav button').forEach(b=>b.classList.remove('active'));e.target.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
        document.getElementById(tabs[btn]).classList.add('active');
      });
    });

    /* ====== å…¨å±€æ•°æ® ====== */
    let badgeData=[];                 // Home ç™»è®°
    let fragmentData=[],fragCount=0;  // ç¢ç‰‡

    /* ===== Badge Library æ¸²æŸ“ ===== */
    const detailBox=document.getElementById('badgeDetail');
    const badgeGrid=document.getElementById('badgeGrid');

     function showDetail(b){
      detailBox.style.display='block';
      detailBox.innerHTML=`
        <div style="display:flex;gap:0.6rem;">
          <img src="assets/images/head.png" style="width:48px;height:48px;">
          <div>
            <h3>${b.en} / ${b.zh}</h3>
            <p>${b.desc}</p>
            <p><strong>Condition:</strong> ${b.cond}</p>
            <p><em>${b.boom}</em></p>
  });
    }
    function buildLibrary(){
      badges.forEach(b=>{
        const div=document.createElement('div');
        div.className='badge-item';
        div.dataset.key=b.key;
        div.innerHTML=`
          <img src="assets/images/badges/${b.key}.png" alt="${b.en}">
          <div class="badge-en">${b.en}</div>
          <div class="badge-zh">${b.zh}</div>
          <span class="badge-tag ${b.cat}">${b.cat}</span>`;
        div.onclick=()=>showDetail(b);
        badgeGrid.appendChild(div);
    
   
          </div>
        </div>`;
    }

    /* High-light collected */
    function updateCollectedVisuals(){
      const owned=new Set(badgeData.map(r=>r.name.toLowerCase().replace(/\s/g,'')));
      document.querySelectorAll('.badge-item').forEach(i=>{
        owned.has(i.dataset.key)?i.classList.add('collected'):i.classList.remove('collected');
      });
    }

    /* ===== Home é€»è¾‘ï¼ˆç™»è®°ã€ç»Ÿè®¡ã€æé†’ã€å¯¼å‡ºï¼‰ ===== */
    const badgeTableBody=document.querySelector('#badgeTable tbody');
    const recentBody=document.querySelector('#recentTable tbody');
    const statTotalEl=document.getElementById('statTotal');
    const statTypesEl=document.getElementById('statTypes');
    const progressBar=document.getElementById('badgeProgress');
    const statRankEl=document.getElementById('statRank');
    const reminderList=document.getElementById('reminderList');
    const wallList=document.getElementById('wallList');

    function updateStats(){
      const total=badgeData.reduce((s,b)=>s+Number(b.qty),0);
      const types=[...new Set(badgeData.map(b=>b.name.toLowerCase().replace(/\s/g,'')))].length;
      statTotalEl.textContent=total;
      statTypesEl.textContent=types;
      progressBar.style.width=Math.min(100,types/20*100)+'%';
      statRankEl.textContent=total>=30?'Archmage':total>=10?'Wizard':'Apprentice';

      reminderList.innerHTML='';
      if(20-types===1) reminderList.innerHTML+='<li>ğŸ‰ è¿˜å·® <strong>1</strong> ç§å¾½ç« å°±é›†é½å…¨éƒ¨å•¦ï¼</li>';
      const need=total<10?10-total:total<30?30-total:0;
      if(need>0) reminderList.innerHTML+=`<li>âœ¨ å†è·å¾— <strong>${need}</strong> æšå³å¯æ™‹çº§ï¼</li>`;

      /* æˆå°±å¢™ç®€ç‰ˆ */
      wallList.innerHTML='';
      badgeData.forEach(b=>{
        const key=b.name.toLowerCase().replace(/\s/g,'');
        if(!wallList.querySelector(`[data-b="${key}"]`))
          wallList.insertAdjacentHTML('beforeend',`<li data-b="${key}">ğŸ… ${b.name} unlocked!</li>`);
      });
    }
    function renderBadgeTables(){
      badgeTableBody.innerHTML='';
      badgeData.forEach(r=>{
        badgeTableBody.insertAdjacentHTML('beforeend',`<tr><td>${r.date}</td><td>${r.name}</td><td>${r.reason}</td><td>${r.qty}</td><td>${r.total}</td></tr>`);
      });
      recentBody.innerHTML='';
      badgeData.slice(-5).reverse().forEach(r=>{
        recentBody.insertAdjacentHTML('beforeend',`<tr><td>${r.date}</td><td>${r.name}</td><td>${r.qty}</td></tr>`);
      });
      updateStats();updateCollectedVisuals();
    }
    document.getElementById('badgeForm').addEventListener('submit',e=>{
      e.preventDefault();
      badgeData.push({
        date:document.getElementById('bDate').value,
        name:document.getElementById('bName').value.trim(),
        reason:document.getElementById('bReason').value.trim(),
        qty:Number(document.getElementById('bQty').value),
        total:Number(document.getElementById('bTotal').value)
      });
      e.target.reset();renderBadgeTables();
    });
    document.getElementById('exportCsvBtn').addEventListener('click',()=>{
      if(!badgeData.length){alert('No data');return;}
      let csv='Date,Badge Name,Reason,Qty,Total\n';
      badgeData.forEach(r=>csv+=`"${r.date}","${r.name}","${r.reason}",${r.qty},${r.total}\n`);
      const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
      const a=document.createElement('a');a.href=url;a.download=`badge_log_${new Date().toISOString().split('T')[0]}.csv`;a.click();URL.revokeObjectURL(url);
    });

    /* ===== Fragment é€»è¾‘ï¼ˆç®€å†™ï¼Œä¸ä¹‹å‰ç›¸åŒï¼‰ ===== */
    const fragSpan=document.getElementById('fragmentCount');
    const fragBar=document.getElementById('fragmentBar');
    const fragBody=document.querySelector('#fragTable tbody');
    function updateFragmentDisplay(){fragSpan.textContent=fragCount;fragBar.style.width=Math.min(100,fragCount)+'%';}
    function renderFragTable(){
      fragBody.innerHTML='';fragmentData.forEach(r=>{
        fragBody.insertAdjacentHTML('beforeend',`<tr><td>${r.date}</td><td>${r.delta}</td><td>${r.qty}</td><td>${r.total}</td><td>${r.reason}</td></tr>`);
      });updateFragmentDisplay();
    }
    document.getElementById('fragForm').addEventListener('submit',e=>{
      e.preventDefault();
      const qty=Number(document.getElementById('fQty').value);
      const type=document.getElementById('fType').value;
      const delta=type==='add'?`+${qty}`:`-${qty}`;fragCount+=type==='add'?qty:-qty;
      fragmentData.push({date:document.getElementById('fDate').value,delta,qty,total:fragCount,reason:document.getElementById('fReason').value.trim()});
      e.target.reset();renderFragTable();
    });
    document.getElementById('fragExportBtn').addEventListener('click',()=>{
      if(!fragmentData.length){alert('No data');return;}
      let csv='Date,Î”,Qty,Total,Reason\n';fragmentData.forEach(r=>csv+=`"${r.date}","${r.delta}",${r.qty},${r.total},"${r.reason}"\n`);
      const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));const a=document.createElement('a');
      a.href=url;a.download=`fragment_log_${new Date().toISOString().split('T')[0]}.csv`;a.click();URL.revokeObjectURL(url);
    });
    document.getElementById('fragRedeemBtn').addEventListener('click',()=>{
      if(fragCount<10){alert('Not enough fragments!');return;}
      fragCount-=10;const today=new Date().toISOString().split('T')[0];
      fragmentData.push({date:today,delta:'-10',qty:10,total:fragCount,reason:'Redeem 1 Badge'});
      renderFragTable();alert('Redeemed 1 badge! Donâ€™t forget to log it in Badge Log.');
    });

    /* åˆå§‹ */
    buildLibrary();
    updateCollectedVisuals();
  </script>
</body>
</html>
