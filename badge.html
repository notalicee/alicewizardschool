<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Badge Room</title>

  <!-- Pangolin Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">

  <!-- ç²’å­ç‰¹æ•ˆ -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- å…¨å±€æ ·å¼ -->
  <link rel="stylesheet" href="style.css" />

  <!-- æœ¬é¡µè¡¥å……æ ·å¼ -->
  <style>
    #particles-js{position:fixed;inset:0;pointer-events:none;z-index:-1;}

    .tab-content{display:none;}
    .tab-content.active{display:block;}

    .backend-nav{display:flex;gap:1rem;margin-bottom:1rem;}
    .backend-nav button{background:#8b6d0c;color:#fff;border:none;padding:.5rem 1rem;border-radius:6px;cursor:pointer;transition:.2s;}
    .backend-nav button:hover{background:#b38b14;}
    .backend-nav button.active{box-shadow:0 0 0 2px #f7e3b2 inset;}

    /* ç»Ÿä¸€å¡ç‰‡å¤–è· */
    .card{margin:0 0 1.5rem;}

    .home-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;}
    @media(max-width:600px){.home-grid{grid-template-columns:1fr;}}

    table{width:100%;border-collapse:collapse;font-size:.95rem;}
    th,td{border:1px solid #e0c990;padding:.45rem .6rem;text-align:center;}
    th{background:#f7e3b2;color:#8b6d0c;}

    .progress-wrap{margin-top:.5rem;background:#f0e6d0;border-radius:6px;height:12px;overflow:hidden;}
    .progress-inner{height:100%;background:#b38b14;width:0%;transition:width .4s;}

    /* Badge Library */
    .badge-gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1rem;}
    .badge-item{text-align:center;border:1px solid #d6c28c;border-radius:8px;padding:.5rem;cursor:pointer;transition:.2s;}
    .badge-item img{width:64px;height:64px;object-fit:contain;margin-bottom:.3rem;}
    .badge-item:hover{transform:translateY(-4px);box-shadow:0 4px 10px rgba(0,0,0,.15);}
    .badge-item.collected{background:rgba(255,223,120,.25);border-color:#f1c40f;box-shadow:0 0 8px 2px rgba(241,196,15,.6);}
    .badge-en{font-weight:600;}
    .badge-zh{font-size:.85rem;color:#8b6d0c;}

    /* è¯¦æƒ…å¡ç‰‡è¿½åŠ è§†è§‰ */
    #badgeDetail{box-shadow:0 2px 6px rgba(0,0,0,.1);padding:1rem;border:1px dashed #e0c990;}

    .frag-log{max-height:180px;overflow-y:auto;}
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <!-- ä¾§è¾¹æ  -->
  <aside class="sidebar">
    <div class="title">Wizard Navigation</div>
    <ul class="nav-links">
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="#" class="active">Badge Room</a></li>
      <li><a href="todo.html">To Do List</a></li>
      <li><a href="wish.html">Wish & Mood</a></li>
      <li><a href="destiny.html">Destiny Room</a></li>
      <li><a href="owltower.html">Owl Tower</a></li>
    </ul>
  </aside>

  <!-- ä¸»ä½“ -->
  <main class="main-content">
    <div class="header-row"><h1 class="header-title">Badge Room</h1></div>

    <!-- BoomBoom Panel -->
    <div class="boom-panel card">
      <div class="boom-avatar"><img src="assets/images/owl-star.png" alt="BoomBoom Owl"></div>
      <div class="boom-text">
        <h2>Welcome to Badge Room!</h2>
        <p id="todayInfo" style="font-size:1rem;margin-bottom:.5rem;"></p>
        <div class="typed-line" id="boomBoomLine"></div>
      </div>
    </div>

    <!-- Tab Buttons -->
    <div class="backend-nav">
      <button id="btnHome" class="active">Home</button>
      <button id="btnLibrary">Badge&nbsp;Library</button>
      <button id="btnFragment">Fragment</button>
      <button id="btnAchievement">Achievement&nbsp;Wall</button>
    </div>

    <!-- ===== â‘  HOME ===== -->
    <section id="tabHome" class="tab-content active">
      <div class="home-grid">
        <!-- ç»Ÿè®¡ -->
        <div class="card">
          <h2>ğŸ“Š Badge Overview</h2>
          <p>Total badges: <strong id="statTotal">0</strong></p>
          <p>Types collected: <strong id="statTypes">0</strong> / 20</p>
          <div class="progress-wrap"><div id="badgeProgress" class="progress-inner"></div></div>
          <p style="margin-top:.4rem;">Rank: <strong id="statRank">Apprentice</strong></p>
        </div>

        <!-- å¾½ç« ç™»è®° -->
        <div class="card">
          <h2>âœï¸ Badge Log</h2>
          <form id="badgeForm" style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.8rem;">
            <input type="date" id="bDate" required>
            <input type="text" id="bName" placeholder="Name" required>
            <input type="text" id="bReason" placeholder="Reason" required>
            <input type="number" id="bQty" placeholder="Qty" min="1" required style="width:70px;">
            <input type="number" id="bTotal" placeholder="Total" min="0" required style="width:85px;">
            <button type="submit">Log</button>
          </form>
          <button id="exportCsvBtn" style="margin-bottom:.5rem;">Export CSV</button>
          <table id="badgeTable"><thead><tr><th>Date</th><th>Name</th><th>Reason</th><th>Qty</th><th>Total</th></tr></thead><tbody></tbody></table>
        </div>

        <!-- æé†’ -->
        <div class="card">
          <h2>ğŸ”” Almost There!</h2>
          <div style="display:flex;gap:.5rem;">
            <img src="assets/images/head.png" style="width:36px;height:36px;">
            <ul id="reminderList" style="list-style:inside;margin:0;padding-left:.2rem;"></ul>
          </div>
        </div>

        <!-- æœ€è¿‘è®°å½• -->
        <div class="card">
          <h2>ğŸ•‘ Recent Log</h2>
          <table id="recentTable"><thead><tr><th>Date</th><th>Name</th><th>Qty</th></tr></thead><tbody></tbody></table>
        </div>
      </div> <!-- ç»“æŸ home-grid -->
    </section>

    <!-- ===== â‘¡ Badge Library ===== -->
    <section id="tabLibrary" class="tab-content">
      <div class="card">
        <h2>ğŸ“š Badge Library</h2>
        <!-- è¯¦æƒ…é¢æ¿æ”¾åœ¨æœ€ä¸Šæ–¹ -->
        <div id="badgeDetail" class="card" style="display:none;"></div>
        <div id="badgeGrid" class="badge-gallery"></div>
      </div>
    </section>

    <!-- ===== â‘¢ Fragment ===== -->
    <section id="tabFragment" class="tab-content">
      <div class="card">
        <h2>âœ¨ Fragment Tracker</h2>
        <p>Fragments: <strong id="fragmentCount">0</strong></p>
        <div class="progress-wrap" style="height:16px;"><div id="fragmentBar" class="progress-inner"></div></div>

        <h3 style="margin-top:1rem;">Log Fragment Change</h3>
        <form id="fragForm" style="display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:.6rem;">
          <input type="date" id="fDate" required>
          <select id="fType"><option value="add">Add</option><option value="use">Use</option></select>
          <input type="number" id="fQty" placeholder="Qty" min="1" required style="width:70px;">
          <input type="text"  id="fReason" placeholder="Reason" required>
          <button type="submit">Log</button>
        </form>
        <div style="display:flex;gap:.6rem;margin-bottom:.6rem;">
          <button id="fragExportBtn">Export CSV</button>
          <button id="fragRedeemBtn">Redeem 10 â†  Badge</button>
        </div>
        <div class="frag-log"><table id="fragTable"><thead><tr><th>Date</th><th>Î”</th><th>Qty</th><th>Total</th><th>Reason</th></tr></thead><tbody></tbody></table></div>
      </div>
    </section>

    <!-- ===== â‘£ Achievement Wall ===== -->
    <section id="tabAchievement" class="tab-content">
      <div class="card">
        <h2>ğŸ† Achievement Wall</h2>
        <ul id="wallList" style="list-style:inside;"></ul>
        <p style="margin-top:1rem;"><a href="shop.html">ğŸ›’ Open Badge Shop (Coming Soon)</a></p>
      </div>
    </section>
  </main>

  <!-- å¾½ç« æ•°æ® -->
  <script src="js/badges.js"></script>

  <!-- ä¸»è„šæœ¬ï¼ˆé€»è¾‘åŒå…ˆå‰ï¼Œä»…ä¿ç•™ä¿®æ”¹æ®µï¼‰ -->
  <script>
    /* ç²’å­èƒŒæ™¯åˆå§‹åŒ– */
    particlesJS("particles-js",{particles:{number:{value:55,density:{enable:true,value_area:900}},
      color:{value:"#b38b14"},shape:{type:"star"},opacity:{value:0.18,random:true},
      size:{value:7,random:true},line_linked:{enable:false},move:{enable:true,speed:1.2}},
      interactivity:{detect_on:"canvas",events:{onhover:{enable:true,mode:"repulse"}}}});

    /* æ—¥æœŸ+æ‰“å­—æ•ˆæœ */
    document.getElementById('todayInfo').textContent=new Date().toDateString();
    const boomLines=[ "âœ¨ A new badge today keeps the dullness away!","ğŸŒŸ Every shard you collect tells a tale of effort!",
      "ğŸª„ Hooray! Another magical moment to log your victory!","ğŸ“œ Badges aren't just awardsâ€”they're wizard legacy!",
      "ğŸ© Polish your wandâ€”achievements await!","ğŸ¦‰ BoomBoom believes in every sparkle you make!","ğŸ–ï¸ One step today is a golden badge tomorrow!",
      "ğŸ’« Log a badge, write Hogwarts history!","ğŸª™ More badges, brighter wizard wall!","ğŸ”¥ Don't stopâ€”BoomBoom watches with pride!" ];
    (function type(idx=0,msg=boomLines[Math.floor(Math.random()*boomLines.length)]){if(idx<msg.length){document.getElementById('boomBoomLine').textContent+=msg[idx];setTimeout(()=>type(idx+1,msg),40);}})();

    /* Tabs */
    const tabs={btnHome:'tabHome',btnLibrary:'tabLibrary',btnFragment:'tabFragment',btnAchievement:'tabAchievement'};
    Object.keys(tabs).forEach(id=>{
      document.getElementById(id).addEventListener('click',e=>{
        document.querySelectorAll('.backend-nav button').forEach(b=>b.classList.remove('active'));e.target.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
        document.getElementById(tabs[id]).classList.add('active');
      });
    });

    /* ====== å…¨å±€æ•°æ® ====== */
    let badgeData=[];let fragmentData=[],fragCount=0;

    /* ===== Library ===== */
    const badgeGrid=document.getElementById('badgeGrid'),badgeDetail=document.getElementById('badgeDetail');
    function buildLibrary(){
      badges.forEach(b=>{
        const d=document.createElement('div');d.className='badge-item';d.dataset.key=b.key;
        d.innerHTML=`<img src="assets/images/${b.key}.png"><div class="badge-en">${b.en}</div><div class="badge-zh">${b.zh}</div><span class="badge-tag ${b.cat}">${b.cat}</span>`;
        d.onclick=()=>showDetail(b);badgeGrid.appendChild(d);
      });
    }
    function showDetail(b){
      badgeDetail.style.display='block';
      badgeDetail.innerHTML=`<div style="display:flex;gap:.6rem;"><img src="assets/images/head.png" style="width:48px;height:48px;"><div><h3>${b.en} / ${b.zh}</h3><p>${b.desc}</p><p><strong>Condition:</strong> ${b.cond}</p><p><em>${b.boom}</em></p></div></div>`;
      badgeDetail.scrollIntoView({behavior:'smooth'});
    }
    function updateCollectedVisuals(){
      const owned=new Set(badgeData.map(r=>r.name.toLowerCase().replace(/\s/g,'')));
      document.querySelectorAll('.badge-item').forEach(i=>owned.has(i.dataset.key)?i.classList.add('collected'):i.classList.remove('collected'));
    }

    /* ===== Home æ•°æ®é€»è¾‘ï¼ˆä¸å…ˆå‰ä¸€è‡´ï¼Œåªå±•ç¤ºæ›´æ–°è¡Œï¼‰ ===== */
    const badgeTableBody=document.querySelector('#badgeTable tbody'),recentBody=document.querySelector('#recentTable tbody');
    const statTotalEl=document.getElementById('statTotal'),statTypesEl=document.getElementById('statTypes');
    const progressBar=document.getElementById('badgeProgress'),statRankEl=document.getElementById('statRank'),reminderList=document.getElementById('reminderList');
    const wallList=document.getElementById('wallList');

    function updateStats(){
      const total=badgeData.reduce((s,b)=>s+Number(b.qty),0);
      const types=[...new Set(badgeData.map(b=>b.name.toLowerCase().replace(/\s/g,'')))].length;
      statTotalEl.textContent=total;statTypesEl.textContent=types;
      progressBar.style.width=Math.min(100,types/20*100)+'%';
      statRankEl.textContent=total>=30?'Archmage':total>=10?'Wizard':'Apprentice';

      reminderList.innerHTML='';
      if(20-types===1) reminderList.innerHTML+='<li>ğŸ‰ è¿˜å·® <strong>1</strong> ç§å¾½ç« å°±é›†é½å…¨éƒ¨å•¦ï¼</li>';
      const need=total<10?10-total:total<30?30-total:0;
      if(need>0) reminderList.innerHTML+=`<li>âœ¨ å†è·å¾— <strong>${need}</strong> æšå³å¯æ™‹çº§ï¼</li>`;
      if(!reminderList.innerHTML.trim())reminderList.innerHTML='<li>ğŸ¦‰ Keep going, young wizardâ€”magic awaits!</li>';

      wallList.innerHTML='';
      badgeData.forEach(b=>{
        const key=b.name.toLowerCase().replace(/\s/g,'');
        if(!wallList.querySelector(`[data-b="${key}"]`))
          wallList.insertAdjacentHTML('beforeend',`<li data-b="${key}">ğŸ… ${b.name} unlocked!</li>`);
      });
    }
    function renderBadgeTables(){
      badgeTableBody.innerHTML='';badgeData.forEach(r=>badgeTableBody.insertAdjacentHTML('beforeend',`<tr><td>${r.date}</td><td>${r.name}</td><td>${r.reason}</td><td>${r.qty}</td><td>${r.total}</td></tr>`));
      recentBody.innerHTML='';badgeData.slice(-5).reverse().forEach(r=>recentBody.insertAdjacentHTML('beforeend',`<tr><td>${r.date}</td><td>${r.name}</td><td>${r.qty}</td></tr>`));
      updateStats();updateCollectedVisuals();
    }
    document.getElementById('badgeForm').addEventListener('submit',e=>{
      e.preventDefault();
      badgeData.push({date:bDate.value,name:bName.value.trim(),reason:bReason.value.trim(),qty:+bQty.value,total:+bTotal.value});
      e.target.reset();renderBadgeTables();
    });

    /* ===== Fragmentï¼ˆä¸å…ˆå‰ä¸€è‡´ï¼‰â€¦ ===== */

    buildLibrary();          /* åˆå§‹åŒ–å›¾é‰´ */
    updateCollectedVisuals();
  </script>
</body>
</html>
