<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Badge Room</title>

  <!-- Pangolin Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">

  <!-- ç²’å­ç‰¹æ•ˆ -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- â˜… ä¸ Dashboard/Owl Tower å…±ç”¨çš„å…¨å±€æ ·å¼ -->
  <link rel="stylesheet" href="style.css" />

  <!-- æœ¬é¡µä¸“å±å¾®è°ƒï¼ˆä»…è¦†ç›–å°‘é‡å·®å¼‚ï¼‰ -->
  <style>
    /* Owl Tower é£æ ¼çš„ Backend Nav æŒ‰é’® */
    .backend-nav{
      display:flex;
      gap:1rem;
      margin-bottom:1rem;
    }
    .backend-nav button{
      background:#8b6d0c;
      color:#fff;
      border:none;
      padding:0.5rem 1rem;
      border-radius:6px;
      cursor:pointer;
    }
    .backend-nav button:hover{
      background:#b38b14;
    }

    /* Home é¡µåŒåˆ—å¡ç‰‡å¸ƒå±€ */
    .home-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:1.5rem;
    }
    @media(max-width:600px){
      .home-grid{grid-template-columns:1fr;}          /* å°å±å•åˆ— */
    }

    /* å³æ æ—¥å¿—è¡¨æ ¼ */
    #recentTable,
    #badgeTable{
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    #recentTable th,#recentTable td,
    #badgeTable th,#badgeTable td{
      border:1px solid #e0c990;
      padding:0.45rem 0.6rem;
      text-align:center;
    }
    #recentTable th,
    #badgeTable th{
      background:#f7e3b2;
      color:#8b6d0c;
    }
  </style>
</head>
<body>
  <!-- ç²’å­èƒŒæ™¯ -->
  <div id="particles-js"></div>

  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <aside class="sidebar">
    <div class="title">Wizard Navigation</div>
    <ul class="nav-links">
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="#" class="active">Badge Room</a></li>
      <li><a href="todo.html">To Do List</a></li>
      <li><a href="wish.html">Wish & Mood</a></li>
      <li><a href="destiny.html">Destiny Room</a></li>
      <li><a href="owltower.html">Owl Tower</a></li>
    </ul>
  </aside>

  <!-- å³ä¾§ä¸»ä½“ -->
  <main class="main-content">
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <div class="header-row">
      <h1 class="header-title">Badge Room</h1>
    </div>

    <!-- BoomBoom Panel -->
    <div class="boom-panel">
      <div class="boom-avatar">
        <img src="assets/images/owl-star.png" alt="BoomBoom Owl">
      </div>
      <div class="boom-text">
        <h2>Welcome to Badge Room!</h2>
        <p id="todayInfo" style="font-size:1rem;margin-bottom:0.5rem;"></p>
        <div class="typed-line" id="boomBoomLine"></div>
      </div>
    </div>

    <!-- Backend-Nav Buttons -->
    <div class="backend-nav">
      <button id="btnHome" class="active">Home</button>
      <button id="btnLibrary">Badge&nbsp;Library</button>
      <button id="btnFragment">Fragment</button>
      <button id="btnAchievement">Achievement&nbsp;Wall</button>
    </div>

    <!-- ==== â‘  HOME TAB ==== -->
    <section id="tabHome" class="tab-content">
      <div class="home-grid">
        <!-- Left-Top: Total Badges -->
        <div class="card">
          <h2>ğŸ… Total Badges</h2>
          <p>Total badges earned: <strong id="totalBadges">0</strong></p>
        </div>

        <!-- Right-Top: Recent Records -->
        <div class="card">
          <h2>ğŸ•‘ Recent Records</h2>
          <table id="recentTable">
            <thead><tr><th>Date</th><th>Name</th><th>Qty</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Left-Bottom: Achievement Triggers -->
        <div class="card">
          <h2>ğŸ‰ Achievement Triggers</h2>
          <ul id="achieveList" style="list-style:inside;"></ul>
        </div>

        <!-- Right-Bottom: Badge Log -->
        <div class="card">
          <h2>âœï¸ Badge Log</h2>
          <form id="badgeForm" style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.8rem;">
            <input type="date" id="bDate" required>
            <input type="text" id="bName" placeholder="Name" required>
            <input type="text" id="bReason" placeholder="Reason" required>
            <input type="number" id="bQty" placeholder="Qty" min="1" required style="width:70px;">
            <input type="number" id="bTotal" placeholder="Total" min="0" required style="width:85px;">
            <button type="submit">Log Badge</button>
          </form>
          <button id="exportCsvBtn" style="margin-bottom:0.5rem;">Export CSV</button>
          <table id="badgeTable">
            <thead>
              <tr><th>Date</th><th>Badge Name</th><th>Reason</th><th>Qty</th><th>Total</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ==== â‘¡ BADGE LIBRARY TAB ==== -->
    <section id="tabLibrary" class="tab-content" style="display:none;">
      <div class="card">
        <h2>ğŸ“š Badge Library</h2>
        <p>Click a badge number to view details.</p>
        <div class="badge-grid" id="badgeGrid">
          <!-- åŠ¨æ€ç”Ÿæˆ 01-20 ç¤ºä¾‹ -->
        </div>
        <div class="badge-desc" id="badgeDesc" style="margin-top:1rem;">Select a badge...</div>
      </div>
    </section>

    <!-- ==== â‘¢ FRAGMENT TAB ==== -->
    <section id="tabFragment" class="tab-content" style="display:none;">
      <div class="card">
        <h2>âœ¨ Fragment</h2>
        <p class="fragment-info">Current fragments: <span id="fragmentCount">0</span></p>
        <div class="progress-bar-container" style="margin-bottom:1rem;">
          <div class="progress-bar" id="fragmentBar"></div>
        </div>
        <!-- è¿™é‡Œå¯ç»§ç»­æ‰©å±•ç™»è®° & å…‘æ¢åŠŸèƒ½ -->
      </div>
    </section>

    <!-- ==== â‘£ ACHIEVEMENT WALL TAB ==== -->
    <section id="tabAchievement" class="tab-content" style="display:none;">
      <div class="card">
        <h2>ğŸ† Achievement Wall</h2>
        <ul id="wallList" style="list-style:inside;"></ul>
      </div>
    </section>
  </main>

  <!-- =================== SCRIPT =================== -->
  <script>
    /* ---------- ç²’å­ç‰¹æ•ˆ ---------- */
    particlesJS("particles-js",{
      particles:{number:{value:55,density:{enable:true,value_area:900}},
      color:{value:"#b38b14"},shape:{type:"star"},opacity:{value:0.18,random:true},
      size:{value:7,random:true},line_linked:{enable:false},move:{enable:true,speed:1.2}},
      interactivity:{detect_on:"canvas",events:{onhover:{enable:true,mode:"repulse"}}}});

    /* ---------- ä»Šæ—¥æ—¥æœŸ ---------- */
    document.getElementById('todayInfo').textContent = new Date().toDateString();

    /* ---------- BoomBoom æ‰“å­—æœºï¼ˆåˆ·æ–°ä¸€æ¬¡éšæœºè¯­å¥ï¼‰ ---------- */
    const boomLines=[
      "âœ¨ A new badge today keeps the dullness away!",
      "ğŸŒŸ Every shard you collect tells a tale of effort!",
      "ğŸª„ Hooray! Another magical moment to log your victory!",
      "ğŸ“œ Badges aren't just awardsâ€”they're wizard legacy!",
      "ğŸ© Polish your wandâ€”achievements await!",
      "ğŸ¦‰ BoomBoom believes in every sparkle you make!",
      "ğŸ–ï¸ One step today is a golden badge tomorrow!",
      "ğŸ’« Log a badge, write Hogwarts history!",
      "ğŸª™ More badges, brighter wizard wall!",
      "ğŸ”¥ Don't stopâ€”BoomBoom watches with pride!"
    ];
    const boomTarget=document.getElementById('boomBoomLine');
    const message=boomLines[Math.floor(Math.random()*boomLines.length)];
    let idx=0;
    (function typeIt(){
      if(idx<message.length){
        boomTarget.textContent+=message.charAt(idx++);
        setTimeout(typeIt,40);
      }
    })();

    /* ---------- Tabs åˆ‡æ¢ ---------- */
    const tabs={
      btnHome:'tabHome',
      btnLibrary:'tabLibrary',
      btnFragment:'tabFragment',
      btnAchievement:'tabAchievement'
    };
    Object.keys(tabs).forEach(btnId=>{
      document.getElementById(btnId).addEventListener('click',e=>{
        // æŒ‰é’®é«˜äº®
        document.querySelectorAll('.backend-nav button').forEach(b=>b.classList.remove('active'));
        e.target.classList.add('active');
        // å†…å®¹åˆ‡æ¢
        Object.values(tabs).forEach(id=>document.getElementById(id).style.display='none');
        document.getElementById(tabs[btnId]).style.display='';
      });
    });

    /* ---------- Badge æ•°æ® & é€»è¾‘ ---------- */
    let badgeData=[]; // æ¯æ¬¡ Log æ·»åŠ 
    const badgeTableBody=document.querySelector('#badgeTable tbody');
    const recentBody=document.querySelector('#recentTable tbody');
    const totalEl=document.getElementById('totalBadges');
    const achieveList=document.getElementById('achieveList');
    const wallList=document.getElementById('wallList');

    function calcTotals(){
      const total=badgeData.reduce((sum,b)=>sum+Number(b.qty),0);
      totalEl.textContent=total;
      // æˆå°±è§¦å‘ç¤ºä¾‹
      achieveList.innerHTML='';
      if(total>=10) achieveList.innerHTML+='<li>ğŸ‰ Earned 10 badges! Great job!</li>';
      if(total>=25) achieveList.innerHTML+='<li>ğŸ… Badge master: 25 badges collected!</li>';
      // åŒæ­¥åˆ°æˆå°±å¢™
      wallList.innerHTML=achieveList.innerHTML;
    }

    function renderTables(){
      /* Badge Table */
      badgeTableBody.innerHTML='';
      badgeData.forEach(row=>{
        badgeTableBody.insertAdjacentHTML('beforeend',
          `<tr><td>${row.date}</td><td>${row.name}</td><td>${row.reason}</td><td>${row.qty}</td><td>${row.total}</td></tr>`);
      });
      /* Recent Table (æœ€å 5 æ¡) */
      recentBody.innerHTML='';
      badgeData.slice(-5).reverse().forEach(r=>{
        recentBody.insertAdjacentHTML('beforeend',
          `<tr><td>${r.date}</td><td>${r.name}</td><td>${r.qty}</td></tr>`);
      });
      calcTotals();
    }

    /* è¡¨å•æäº¤ */
    document.getElementById('badgeForm').addEventListener('submit',e=>{
      e.preventDefault();
      const row={
        date:document.getElementById('bDate').value,
        name:document.getElementById('bName').value.trim(),
        reason:document.getElementById('bReason').value.trim(),
        qty:Number(document.getElementById('bQty').value),
        total:Number(document.getElementById('bTotal').value)
      };
      badgeData.push(row);
      e.target.reset();
      renderTables();
    });

    /* CSV å¯¼å‡º */
    document.getElementById('exportCsvBtn').addEventListener('click',()=>{
      if(!badgeData.length){alert('No data');return;}
      let csv='Date,Badge Name,Reason,Qty,Total\n';
      badgeData.forEach(r=>{
        csv+=`"${r.date}","${r.name}","${r.reason}",${r.qty},${r.total}\n`;
      });
      const blob=new Blob([csv],{type:'text/csv'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url;a.download=`badge_log_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();URL.revokeObjectURL(url);
    });

    /* ---------- Badge Library æ¼”ç¤º ---------- */
    const badgeGrid=document.getElementById('badgeGrid');
    const badgeDesc=document.getElementById('badgeDesc');
    for(let i=1;i<=20;i++){
      const num=String(i).padStart(2,'0');
      const div=document.createElement('div');
      div.className='badge-item';
      div.textContent=num;
      div.onclick=()=>badgeDesc.innerHTML=`Badge ${num}<br>Description: ...<br>Condition: ---`;
      badgeGrid.appendChild(div);
    }

    /* ---------- Fragment ç¤ºä¾‹ ---------- */
    let fragCount=0;
    const fragSpan=document.getElementById('fragmentCount');
    const fragBar=document.getElementById('fragmentBar');
    function updateFragment(n){fragCount=n;fragSpan.textContent=fragCount;fragBar.style.width=Math.min(100,fragCount)+'%';}
    updateFragment(12); // ç¤ºä¾‹
  </script>
</body>
</html>
