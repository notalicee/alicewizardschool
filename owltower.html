<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>To-Do List with CSV Export</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    .task-item { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .task-item input[type="checkbox"] { transform: scale(1.3); }
    .task-item span { flex: 1; }
    .add-task { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>To-Do List (Export to CSV)</h1>

  <!-- 任务列表容器 -->
  <div id="taskList"></div>

  <!-- 添加新任务输入区 -->
  <div class="add-task">
    <input type="text" id="newTaskText" placeholder="Enter task..." />
    <button id="btnAddTask">Add Task</button>
  </div>

  <!-- 导出CSV按钮 -->
  <button id="btnExportCSV" style="margin-top:1rem;">Export to CSV</button>

  <script>
    // ========== 1. 数据存储：在JS内用数组记录 ==========
    // 这里也可以改用 localStorage, 使刷新后仍保留
    let tasks = [
      { id: 101, text: "Read Harry Potter", done: false },
      { id: 102, text: "Practice broom flying", done: true },
    ];

    // ========== 2. 渲染任务列表到页面 ==========
    const taskListEl = document.getElementById('taskList');

    function renderTasks() {
      taskListEl.innerHTML = '';
      tasks.forEach(task => {
        const div = document.createElement('div');
        div.classList.add('task-item');

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = task.done;
        checkbox.addEventListener('change', ()=>{
          task.done = checkbox.checked;
        });
        div.appendChild(checkbox);

        const span = document.createElement('span');
        span.textContent = task.text + " (#" + task.id + ")";
        div.appendChild(span);

        const delBtn = document.createElement('button');
        delBtn.textContent = "Del";
        delBtn.onclick = ()=> {
          tasks = tasks.filter(t => t !== task);
          renderTasks();
        };
        div.appendChild(delBtn);

        taskListEl.appendChild(div);
      });
    }
    renderTasks();

    // ========== 3. 添加新任务 ==========
    const newTaskTextEl = document.getElementById('newTaskText');
    const btnAddTask = document.getElementById('btnAddTask');
    function addTask() {
      const textVal = newTaskTextEl.value.trim();
      if(!textVal) return;
      const newId = Date.now(); // 简单生成ID
      tasks.push({ id: newId, text: textVal, done: false });
      newTaskTextEl.value = '';
      renderTasks();
    }
    btnAddTask.addEventListener('click', addTask);

    // ========== 4. 导出CSV按钮功能 ==========
    const btnExportCSV = document.getElementById('btnExportCSV');
    btnExportCSV.addEventListener('click', exportTasksToCSV);

    function exportTasksToCSV() {
      // 准备CSV内容
      // 设定表头： id, text, done
      let csvContent = "id,text,done\n";
      tasks.forEach(task => {
        // 用逗号分隔
        const row = `${task.id},"${task.text.replace(/"/g,'""')}",${task.done}`;
        csvContent += row + "\n";
      });

      // 通过Blob生成可下载链接
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);

      // 创建临时<a>标签来触发下载
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', 'tasks.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
